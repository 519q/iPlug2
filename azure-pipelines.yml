trigger:
- azure

jobs:
- job: Build
  strategy:
    matrix:
      mac:
        imageName: 'macos-10.13'
        isMac: true
#      windows:
#        imageName: 'vs2017-win2016'
#        isWindows: true
#      linux:
#      imageName: 'ubuntu-16.04'
#        isLinux: true

  pool:
    vmImage: $(imageName)
    
  steps:
  - checkout: self

  # - bash: |
  #     ./Dependencies/IGraphics/build-igraphics-libs-mac.sh
  #   condition: variables.isMac
  #   displayName: Build macOS IGraphics Dependencies

  - script:
      export LLVM7_MAC=http://releases.llvm.org/7.0.0/clang+llvm-7.0.0-x86_64-apple-darwin.tar.xz
      curl -L $LLVM7_MAC --output llvm7.tar.xz
      mkdir ./Dependencies/tmp
      tar -xf llvm7.tar.xz -C ./Dependencies/tmp
      ls -la ./Dependencies/tmp/clang+llvm-7.0.0-x86_64-apple-darwin
      echo "setting path to $HOME/Dependencies/tmp/clang+llvm-7.0.0-x86_64-apple-darwin/bin"
      export PATH=$HOME/Dependencies/tmp/clang+llvm-7.0.0-x86_64-apple-darwin/bin:$PATH
    displayName: Build macOS Extras Dependencies - LLVM

  - bash: |
      echo $PATH
      cd ./Dependencies/Extras/faust/
      # ./build-faust-mac.sh
    condition: variables.isMac
    displayName: Build macOS Extras Dependencies - FAUST

  - bash: |
      cd ./Dependencies/Extras/civetweb/
      ./build-civetweb-mac.sh
    condition: variables.isMac
    displayName: Build macOS Extras Dependencies - CIVETWEB

  - bash: |
      cd ./Dependencies/
      tar -cvzf iplug2_deps_macOS.tar.gz mac
    condition: variables.isMac
    displayName: Package macOS Dependencies Artifacts

  - task: PublishPipelineArtifact@0
    inputs:
      artifactName: 'IPLUG2_DEPS_MACOS'
      targetPath: './Dependencies/Build/iplug2_deps_macOS.tar.gz'
    condition: variables.isMac
    displayName: Publish macOS Dependencies Artifacts

  
#  - task: Xcode@5
#    inputs:
#      actions: 'build'
#      scheme: 'APP'
#      sdk: 'macosx10.13'
#      configuration: 'Release'
#      xcWorkspacePath: 'Tests/IGraphicsTest/IGraphicsTest.xcworkspace'
#      xcodeVersion: "9"
