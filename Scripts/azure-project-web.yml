parameters:
  name: ''
  graphics: 'NANOVG'
  #todo: problems if the project doesn't use nanovg by default
  graphicsStr: 'IGRAPHICS_NANOVG'
  path: ''
  configuration: 'Release'

steps:
  - bash: |
      # cd ./${{ parameters.path }}/${{ parameters.name }}/config
      # sed -i.bu 's/IGRAPHICS_NANOVG IGRAPHICS_METAL/${{ parameters.graphicsStr }}/' ${{ parameters.name }}-web.mk
    displayName: Set graphics string

  - bash: |
      cd ./${{ parameters.path }}/${{ parameters.name }}/scripts
      ./makedist-web.sh
    displayName: Compile WAM

  - task: PublishPipelineArtifact@0
    inputs:
      artifactName: 'WEB_${{ parameters.name }}_${{ parameters.graphics }}'
      targetPath: '${{ parameters.path }}/${{ parameters.name }}/build-web'
    displayName: Publish ${{ parameters.name }}